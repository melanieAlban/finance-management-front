<!-- src/app/components/automation/list-automation/list-automation.component.html -->
<app-toast
  [severity]="severity"
  [summary]="summary"
  [detail]="detail">
</app-toast>

<div class="bg-gray-100 text-gray-900 p-6">
  <div class="flex justify-between items-center mb-6">
    <h1 class="text-2xl font-semibold text-gray-900">Lista de Automatizaciones</h1>
    <app-button icon="pi pi-plus" label="Nueva Automatización" raised="true" (click)="modalVisible = true"/>
  </div>

  <app-modal [(visible)]="modalVisible" [width]="'40vw'" header="{{ isEditMode ? 'Editar Automatización' : 'Crear Automatización' }}">
    <div class="space-y-4">
        <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Nombre</label>
            <app-custom-input
              [placeholder]="'Ej: Renta, Spotify, Ahorro...'"
              [(ngModel)]="nameAutomation"/>
        </div>
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-1">Monto</label>
        <app-custom-input
          [placeholder]="'Ingrese el monto...'"
          [type]="'number'"
          [(ngModel)]="amountAutomation"/>
        <span class="text-xs ml-2 text-gray-500">
          "Recuerde que el monto debe ser positivo para ingresos y negativo para gastos."
        </span>
      </div>

      <div>
        <label class="block text-sm font-medium text-gray-700 mb-1">Frecuencia</label>
        <p-select
          [options]="frequencies"
          [(ngModel)]="frequencyAutomation"
          optionValue="value"
          optionLabel="name"
          placeholder="Seleccione la frecuencia"
          showClear="true"/>
      </div>

      <div>
        <label class="block text-sm font-medium text-gray-700 mb-1">Fecha de Inicio</label>
        <app-custom-input
          [placeholder]="'Seleccione la fecha de inicio...'"
          [type]="'date'"
          [(ngModel)]="startDateAutomation"/>
      </div>

      <div>
        <label class="block text-sm font-medium text-gray-700 mb-1">Cuenta</label>
        <p-select
          [options]="accounts"
          [(ngModel)]="accountIdAutomation"
          optionValue="id"
          optionLabel="name"
          placeholder="Seleccione la cuenta"
          showClear="true"/>
      </div>

      <div>
        <label class="block text-sm font-medium text-gray-700 mb-1">Categoría</label>
        <p-select
          [options]="categories"
          [(ngModel)]="categoryAutomation"
          optionValue="value"
          optionLabel="name"
          placeholder="Seleccione la categoría"
          showClear="true"/>
      </div>

      <div class="flex justify-end space-x-3 pt-4">
        <app-button
          icon="pi pi-check"
          label="{{ isEditMode ? 'Actualizar' : 'Registrar' }}"
          raised="true"
          (click)="guardarAutomation()"/>
        <app-button
          icon="pi pi-times"
          label="Cancelar"
          raised="true"
          severity="danger"
          (click)="cancelar()"/>
      </div>
    </div>
  </app-modal>

  <!-- Modal de Confirmación de Eliminación -->
  <app-modal [(visible)]="confirmModalVisible" [width]="'30vw'" header="Confirmar Eliminación">
    <div class="space-y-4">
      <p class="text-gray-700">{{ detail }}</p>
      <div class="flex justify-end space-x-3">
        <app-button
          icon="pi pi-check"
          label="Aceptar"
          raised="true"
          (click)="eliminarAutomation()"/>
        <app-button
          icon="pi pi-times"
          label="Cancelar"
          raised="true"
          severity="danger"
          (click)="cerrarConfirmacion()"/>
      </div>
    </div>
  </app-modal>

  <div class="flex flex-wrap gap-4 mb-6 items-end">
    <p-select
      [options]="categories"
      [(ngModel)]="filtroCategoria"
      optionValue="value"
      optionLabel="name"
      placeholder="Filtrar por categoría"
      showClear="true"/>
    <p-select
      [options]="frequencies"
      [(ngModel)]="filtroFrecuencia"
      optionValue="value"
      optionLabel="name"
      placeholder="Filtrar por frecuencia"
      showClear="true"/>
  </div>

  <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6 mb-6">
    <app-card *ngFor="let automation of automationsFiltradas">
      <div class="flex flex-col items-center mb-4">
        <!-- Nombre y Frecuencia -->
        <div class="flex justify-between items-center mb-2 text-xs w-full">
          <div class="text-gray-800 flex items-center w-3/4">
            <h2 class="text-lg font-semibold truncate">{{ automation.name }}</h2>
            <span class="inline-block ml-2 px-2 py-1 text-xs font-semibold rounded-full" [ngClass]="getFrequencyClass(automation.frequency)">
              {{ getFrequencyName(automation.frequency) }}
            </span>
          </div>
        </div>
  
        <!-- Monto más grande -->
        <div class="text-center text-gray-700 mb-4">
          <p class="text-lg">
            <span class="font-semibold">Monto:</span> 
            <strong [ngClass]="{
              'text-green-500': automation.amount > 0, 
              'text-red-500': automation.amount < 0
            }">
              {{ automation.amount > 0 ? '+' : '' }}{{ automation.amount | currency:'USD' }}
            </strong>
          </p>
        </div>
  
        <!-- Cuenta -->
        <div class="flex items-center w-full mb-2 text-sm">
          <i class="pi pi-wallet mr-1 text-gray-600"></i>
          <span class="font-semibold">Cuenta:</span> <strong>{{ getAccountName(automation.accountId) }}</strong>
        </div>
  
        <!-- Fecha de Inicio -->
        <div class="flex items-center w-full mb-2 text-sm">
          <i class="pi pi-calendar mr-1 text-gray-600"></i>
          <span class="font-semibold">Fecha de Inicio:</span> <strong>{{ automation.startDate | date:'shortDate' }}</strong>
        </div>
  
        <!-- Última Ejecución -->
        <div class="flex items-center w-full mb-2 text-sm">
          <i class="pi pi-clock mr-1 text-gray-600"></i>
          <span class="font-semibold">Última Ejecución:</span> <strong>{{ automation.lastExecutionDate | date:'shortDate' }}</strong>
        </div>
  
        <!-- Categoría -->
        <div class="flex items-center w-full mb-2 text-sm">
          <i class="pi pi-tags mr-1 text-gray-600"></i>
          <span class="font-semibold">Categoría:</span> <strong>{{ getCategoryName(automation.category) }}</strong>
        </div>
      </div>
  
      <!-- Botones de acción -->
      <div class="flex justify-end space-x-3">
        <app-button
          icon="pi pi-pencil"
          severity="warn"
          rounded="true"
          text="true"
          class="p-button-rounded p-button-warning p-button-outlined text-xs"
          (click)="editarAutomation(automation)"
        ></app-button>
        
        <app-button
          icon="pi pi-trash"
          severity="danger"
          rounded="true"
          text="true"
          class="p-button-rounded p-button-danger p-button-outlined text-xs"
          (click)="confirmarEliminacion(automation)"
        ></app-button>
      </div>
    </app-card>
  </div>
  
  
</div>